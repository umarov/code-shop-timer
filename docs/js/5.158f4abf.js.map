{"version":3,"sources":["webpack:///src/components/TimerNotification/TimerNotification.vue","webpack:///./src/components/TimerNotification/TimerNotification.vue?d6b4","webpack:///./src/components/TimerNotification/TimerNotification.vue"],"names":["TimerNotification","Worker","permission","timerWorker","_this","this","setupTokens","_this2","firebaseMessaging","getToken","then","onTokenReceived","catch","notificationNotAllowed","fireEventWithNotificationState","currentToken","getCachedOverride","token","_this3","requestPermission","notificationAllowed","notificationOverride","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","row","center","justify-space-around","outline","flat","color","nativeOn","click","$event","subscribeForNotifications","_v","notificationPermission","_e","staticRenderFns","__vue_template_functional__","__vue_styles__","__vue_scopeId__","__vue_module_identifier__","Component","Object","component_normalizer","__webpack_exports__"],"mappings":"uGAyBA,IAAAA,QAEA,8CAKAC,oEAGAC,+BACA,WACA,iBAEAC,iCAEA,IAAAC,EAAAC,gCAEAC,+EAGAA,iDAKA,IAAAC,EAAAF,YACAG,kBACAC,WAAAC,KAAAL,KACAM,iBAAAC,MAAAP,KACAQ,wBAAAH,KAAAL,KACAS,0FAEAN,kBACAC,WAAAC,KAAAH,EACAI,iBAAAC,MAAAL,EACAM,wBAAAH,KAAAH,EACAO,6EAKAC,yBACAA,iCACAC,0BAEAH,sFAIA,gFAIA,oBAEAI,oFAGAD,2DAEA,IAAAE,EAAAb,YACAG,kBACAW,oBAAAT,KAAA,oCAEAU,0CACAA,uBACAR,MAAA,gCAEA,yCAIA,mIAGAS,QACAP,oCCtGAQ,EAAA,WAA0B,IAAAC,EAAAlB,KAAamB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAAH,EAAA,MAAAG,EAAA,YAA4CE,YAAA,iBAAAC,OAAoCC,IAAA,GAAAC,OAAA,GAAAC,uBAAA,MAAgDN,EAAA,UAAAH,EAAA,oBAAAG,EAAA,SAAqDE,YAAA,cAAAC,OAAiCI,QAAA,GAAAC,KAAA,GAAAC,MAAA,SAAuCC,UAAWC,MAAA,SAAAC,GAAyBf,EAAAgB,gCAAkChB,EAAAiB,GAAA,yCAAAd,EAAA,UAAAH,EAAAiB,GAAA,mCAAAjB,EAAAkB,uBAAAf,EAAA,SAAoJE,YAAA,aAAAC,OAAgCI,QAAA,GAAAC,KAAA,GAAAC,MAAA,SAAuCC,UAAWC,MAAA,SAAAC,GAAyBf,EAAAgB,gCAAkChB,EAAAiB,GAAA,sDAAAd,EAAA,UAAAH,EAAAiB,GAAA,sCAAAjB,EAAAkB,uBAAAf,EAAA,SAAoKE,YAAA,aAAAC,OAAgCI,QAAA,GAAAC,KAAA,GAAAC,MAAA,SAAuCC,UAAWC,MAAA,SAAAC,GAAyBf,EAAAgB,gCAAkChB,EAAAiB,GAAA,6CAAAd,EAAA,UAAAH,EAAAiB,GAAA,2BAAAd,EAAA,SAAiHE,YAAA,YAAAC,OAA+BI,QAAA,GAAAC,KAAA,GAAAC,MAAA,SAAuCC,UAAWC,MAAA,SAAAC,GAAyBf,EAAAgB,gCAAkChB,EAAAiB,GAAA,0CAAAd,EAAA,UAAAH,EAAAiB,GAAA,oCAAAjB,EAAAmB,MAAA,IAC3uCC,iBCKAC,GAAA,EAEAC,EAAA,KAEAC,EAAA,KAEAC,EAAA,KAEAC,EAAAC,OAAAC,EAAA,KAAAD,CACAjD,EACAsB,EACAqB,EACAC,EACAC,EACAC,EACAC,GAGAI,EAAA,WAAAH,EAAA","file":"js/5.158f4abf.js","sourcesContent":["<template>\n  <div>\n    <v-layout v-if=\"token\" row center justify-space-around class=\"text-xs-center\">\n      <v-flex>\n        <v-btn outline flat color=\"green\" @click.native=\"subscribeForNotifications()\" v-if=\"notificationAllowed\" class=\"green--text\">\n          Nofitications: On\n          <v-icon>notifications</v-icon>\n        </v-btn>\n        <v-btn outline flat color=\"green\" @click.native=\"subscribeForNotifications()\" v-else-if=\"notificationPermission === 'default'\" class=\"grey--text\">\n          Nofitications: Need permission\n          <v-icon>notifications_off</v-icon>\n        </v-btn>\n        <v-btn outline flat color=\"green\" @click.native=\"subscribeForNotifications()\" v-else-if=\"notificationPermission === 'denied'\" class=\"grey--text\">\n          Nofitications: Denied\n          <v-icon>notifications_off</v-icon>\n        </v-btn>\n        <v-btn outline flat color=\"green\" @click.native=\"subscribeForNotifications()\" v-else class=\"red--text\">\n          Nofitications: Off\n          <v-icon>notifications_none</v-icon>\n        </v-btn>\n      </v-flex>\n    </v-layout>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"timer-notification\",\n  props: {\n    timerWorker: {\n      type: Worker\n    }\n  },\n  data() {\n    return {\n      notificationPermission: Notification.permission,\n      notificationAllowed: null,\n      token: null,\n      worker: this.timerWorker\n    };\n  },\n  mounted() {\n    if (window.swRegistration) {\n      this.setupTokens();\n    } else {\n      document.addEventListener(\"serviceWorkerRegistered\", () => {\n        this.setupTokens();\n      });\n    }\n  },\n  methods: {\n    setupTokens() {\n      window.firebaseMessaging\n        .getToken()\n        .then(this.onTokenReceived)\n        .catch(this.notificationNotAllowed)\n        .then(this.fireEventWithNotificationState);\n      window.firebaseMessaging.onTokenRefresh(() => {\n        window.firebaseMessaging\n          .getToken()\n          .then(this.onTokenReceived)\n          .catch(this.notificationNotAllowed)\n          .then(this.fireEventWithNotificationState);\n      });\n    },\n    onTokenReceived(currentToken) {\n      if (currentToken) {\n        this.token = currentToken;\n        this.sendTokenToWorker(currentToken);\n        this.notificationAllowed = this.getCachedOverride();\n      } else {\n        this.notificationNotAllowed();\n      }\n    },\n    notificationNotAllowed() {\n      this.notificationAllowed = false;\n    },\n    sendTokenToWorker(token) {\n      this.worker.postMessage({\n        setNotificationToken: true,\n        notificationToken: token\n      });\n    },\n    fireEventWithNotificationState() {\n      this.$emit(\"notification-state\", this.getCachedOverride());\n    },\n    subscribeForNotifications() {\n      window.firebaseMessaging\n        .requestPermission()\n        .then(() => {\n          this.notificationAllowed = !this.notificationAllowed;\n          this.setCachedOverride(this.notificationAllowed);\n        })\n        .catch(() => {\n          this.setCachedOverride(false);\n        });\n    },\n    getCachedOverride() {\n      return localStorage.getItem(\"notification-override\") === \"true\";\n    },\n    setCachedOverride(notificationOverride) {\n      localStorage.setItem(\"notification-override\", notificationOverride);\n      this.fireEventWithNotificationState();\n    }\n  }\n};\n</script>\n\n\n\n// WEBPACK FOOTER //\n// src/components/TimerNotification/TimerNotification.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(_vm.token)?_c('v-layout',{staticClass:\"text-xs-center\",attrs:{\"row\":\"\",\"center\":\"\",\"justify-space-around\":\"\"}},[_c('v-flex',[(_vm.notificationAllowed)?_c('v-btn',{staticClass:\"green--text\",attrs:{\"outline\":\"\",\"flat\":\"\",\"color\":\"green\"},nativeOn:{\"click\":function($event){_vm.subscribeForNotifications()}}},[_vm._v(\"\\n        Nofitications: On\\n        \"),_c('v-icon',[_vm._v(\"notifications\")])],1):(_vm.notificationPermission === 'default')?_c('v-btn',{staticClass:\"grey--text\",attrs:{\"outline\":\"\",\"flat\":\"\",\"color\":\"green\"},nativeOn:{\"click\":function($event){_vm.subscribeForNotifications()}}},[_vm._v(\"\\n        Nofitications: Need permission\\n        \"),_c('v-icon',[_vm._v(\"notifications_off\")])],1):(_vm.notificationPermission === 'denied')?_c('v-btn',{staticClass:\"grey--text\",attrs:{\"outline\":\"\",\"flat\":\"\",\"color\":\"green\"},nativeOn:{\"click\":function($event){_vm.subscribeForNotifications()}}},[_vm._v(\"\\n        Nofitications: Denied\\n        \"),_c('v-icon',[_vm._v(\"notifications_off\")])],1):_c('v-btn',{staticClass:\"red--text\",attrs:{\"outline\":\"\",\"flat\":\"\",\"color\":\"green\"},nativeOn:{\"click\":function($event){_vm.subscribeForNotifications()}}},[_vm._v(\"\\n        Nofitications: Off\\n        \"),_c('v-icon',[_vm._v(\"notifications_none\")])],1)],1)],1):_vm._e()],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-d9bedd6e\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/TimerNotification/TimerNotification.vue\n// module id = null\n// module chunks = ","/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/mumarov/code/code-shop-timer/node_modules/.cache/cache-loader\\\"}!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./TimerNotification.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/mumarov/code/code-shop-timer/node_modules/.cache/cache-loader\\\"}!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./TimerNotification.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-d9bedd6e\\\",\\\"hasScoped\\\":false,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./TimerNotification.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/TimerNotification/TimerNotification.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}